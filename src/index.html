<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="engine/public/css/bootstrap.css" type="text/css"/>
	<link rel="stylesheet" href="engine/public/css/font-awesome.min.css" type="text/css"/>
	<script src="engine/public/js/aes.js" type="text/javascript"></script>
	<script src="engine/public/js/config.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery-2.1.1.min.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.hotkeys.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.linkify.min.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.autogrow.js" type="text/javascript"></script>
	<script src="engine/public/js/functions.js" type="text/javascript"></script>
	<script src="engine/public/js/bootstrap.js" type="text/javascript"></script>
	<script src="engine/public/js/window.js" type="text/javascript"></script>
	<script src="engine/public/js/ajax.js" type="text/javascript"></script>
	<script src="engine/public/js/jsOAuth-1.1.js" type="text/javascript"></script>
	<script src="engine/public/js/twitter.js" type="text/javascript"></script>
	<script src="engine/public/js/screenshot.js" type="text/javascript"></script>
	<script type="text/javascript">
		global.sct = false;
		global.scf = false;
		global.hashtag_db_loaded = false;
		$(document).ready(function() {
			$('#tweet-send').css('overflow', 'hidden').autogrow()
			window.reply=false;
			$("#tweet-send").bind('keydown', 'ctrl+return', function() {
				tryToPost("tweet-send-button");
			});
			$("#tweet-send").bind('keydown', 'enter', function() {
				tryToPost("tweet-send-button");
			});
			$("#tweet-send").bind('keydown', 'ctrl+c', resetCharLimit);
		});
	</script>
	<style>
		html {
			background: url('engine/public/img/tweet_home.jpg') fixed #333;
			/*background: url('engine/public/img/blue_corsair_bg.png') fixed #FFF;*/
			background-size: cover;
		}
		body {
			background: transparent;
			color: #FFF;
			text-shadow: 1px 1px 5px rgba(0,0,0,0.3);
		}
		a {
			color: #CCC !important;
		}
		.item {
			background: rgba(0,0,0,0.6);
			padding: 15px;
			margin-bottom: 15px;
			border-radius: 5px;
		}

		.sidebar-box {
			max-width: 275px;
			min-width: 275px;
			position: fixed;
		}
		
		.btn-tweet-wrapper {
			display:-moz-box;
			-moz-box-pack:center;
			-moz-box-align:center;		

			display:-webkit-box;
			-webkit-box-pack:center;
			-webkit-box-align:center;
		}
		
		#char-left {
			pointer-events: none;
			cursor: not-allowed;
		}
	</style>
</head>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" style="background: rgba(0,0,0,0.55);border-bottom:1px solid #000;border-radius:none !important;box-shadow:0px 0px 5px rgba(0,0,0,0.2);">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#"><i class="fa fa-heart"></i>Twimber</a>
    </div>
    <div class="collapse navbar-collapse">
		<ul class="nav navbar-nav navbar-right">
				<li><a href="#id=null&action=clear"><i class="fa fa-times"></i> Clear</a></li>
				<li><a href="#" onclick="initStream();"><i class="fa fa-refresh"></i> Reload Stream</a></li>
				<li><a href="#" onclick="logout();"><i class="fa fa-lock"></i> Logout</a></li>
      	</ul>
    </div>
  </div>
</nav>
	<body style="margin-top:70px;">
		<div id="tweet-ctr" class="tweet col-md-9">
		</div>
		<div class="col-md-3">
			<div class="item sidebar-box">
				<div style='text-align:center' id='user_div'></div>
				<textarea id="tweet-send" class="form-control" placeholder="Hello world."></textarea><br>
				<div class="btn-group btn-tweet-wrapper">
					<button id='tweet-send-button' onclick="statusFunc()" class="btn btn-default" type="button" focus> <i class="fa fa-twitter"> Tweet</i></button>
					<button id='char-left' style="color: #333;background-color: #fff;border-color:#ccc;" class="btn" type="button" focus> 0 </i></button>
					<button id='tweet-select-file' onclick="selectFile()" class="btn btn-default" type="button" focus> Upload <i class="fa fa-upload"></i></button>
				</div>
				<div>&nbsp;</div>
				<div id='twitter_errors'></div>
				<div id='twitter_success'></div>
			</div>
		</div>
		<script type="text/javascript">
		function statusFunc() {
			var before = document.getElementById('tweet-send-button').innerHTML;
			doLoadThing("tweet-send-button");
			if(window.reply===true) {
				var id = window.tweetid;
				var status = document.getElementById("tweet-send").value;
				doReply(id, status);
				document.getElementById("tweet-send").value="";
				console.log("[main] statusFunc: window.reply set too false");
				window.reply = false;
			} else {
				var status = document.getElementById("tweet-send").value;
				postStatus(status);
				document.getElementById("tweet-send").value="";
			}
			document.getElementById('tweet-send-button').innerHTML=before;
		}
		</script>
		<script type="text/javascript">initStream();</script>
		<script>
			var limit = 138;
			var txt =  $('textarea[id$=tweet-send]');
			$('#char-left').text(140);
			$(txt).keypress(function() {
				var len = $(this).val().length;
				if (len > limit) {
					//this.value = this.value.substring(0, 50);
					$(this).addClass('goRed');
					$('#char-left').text(len - limit);
					return false;
				} else {
					$(this).removeClass('goRed');
					$('#char-left').text(limit - len);
				}
			});
		</script>
		<script type="text/javascript">
			$('#twitter_errors').bind('DOMNodeInserted', function(event) {
				if(global.scf === false) {
					global.scf = true;
					setTimeout(function () {
						$('#twitter_errors').children('div').each(function(i, obj) {
							$(this).fadeOut("slow", function() { $(this).remove(); });
						});
						global.scf = false;
					}, 5000);
				} else {
					console.log("[index.html] Fade has already been scheduled");
				}
			});
			$('#twitter_success').bind('DOMNodeInserted', function(event) {
				if(global.sct === false) {
					global.sct = true;
					setTimeout(function () {
						$('#twitter_success').children('div').each(function(i, obj) {
							$(this).fadeOut("slow", function() { $(this).remove(); });
						});
						global.sct = false;
					}, 5000);
				} else {
					console.log("[index.html] Fade has already been scheduled");
				}
			});
		</script>
		<script type="text/javascript">
			var Twit = require('twitter');
			eval(getConfigFile());
			var T = new Twit(window.config);
			T.get('users/show', { screen_name: window.config.screen_name } , function(err, data, response) {
				if(err) {
					parseTwitterError(err);
				}
				console.log("[index.html] Load User image resp: ");
				console.log(data);
				document.getElementById("user_div").innerHTML="<img src='"+data.profile_image_url.replace('normal', 'bigger')+"' alt='"+data.screen_name+"'><h2>"+data.name+"</h2><h3>@"+data.screen_name+"</h2>";
			});
		</script>
	</body>
</html>