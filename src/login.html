<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>vTweet</title>

    <!-- Bootstrap core CSS -->
    <link href="engine/public/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="engine/public/css/cover.css" rel="stylesheet">
	
	<script type="text/javascript">
		function doLogin() {
			var user = document.getElementById("login-username").value;
			doLoadThing("login-button");
			requestPin(user);
		}
	</script>
	<script src="engine/public/js/config.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery-2.1.1.min.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.hotkeys.js" type="text/javascript"></script>
	<script src="engine/public/js/bootstrap.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.linkify.min.js" type="text/javascript"></script>
	<script src="engine/public/js/jquery.backstretch.js" type="text/javascript"></script>
	<script src="engine/public/js/functions.js" type="text/javascript"></script>
	<script src="engine/public/js/screenshot.js" type="text/javascript"></script>
	<script src="engine/public/js/jsOAuth-1.1.js" type="text/javascript"></script>
	<script src="engine/public/js/twitter.js" type="text/javascript"></script>
	<script type="text/javascript">
		function loadContent(hash) {
			console.log("[login.html] (): Hash Changed -- Changing Content accordingly.");
			if(hash !== "" ) {
				if(hash == "#contact") {
					document.getElementById("nav-menu").innerHTML="<li><a href='#'>Home</a></li><li><a href='#about'>About</a></li><li class='active'><a href='#contact'>Contact</a></li>";
					document.getElementById("main-disp").innerHTML="<p class='lead'>&nbsp;</p><h1 class='cover-heading'>UC</h1><p class='lead'>&nbsp;</p>";
				} else if (hash == "#about") {
					document.getElementById("nav-menu").innerHTML="<li><a href='#'>Home</a></li><li class='active'><a href='#about'>About</a></li><li><a href='#contact'>Contact</a></li>";
					document.getElementById("main-disp").innerHTML="<p class='lead'>&nbsp;</p><h1 class='cover-heading'>UC</h1><p class='lead'>&nbsp;</p>";
				} else if(hash == "#users") {
					var Twit = require('twitter');
					var T = new Twit(window.config);
					
					/** Check Creds **/
					T.get('account/verify_credentials', function(err, data, response) {
						console.log("[twitter] /initStream/ => [checkCreds]: Got a response from Twitter");
						console.log(data);
						if (data.status.source == "web") {
							var source="<a href='http://twitter.com/'>web</a>"
						} else {
							var source=data.status.source
						}
						document.getElementById("nav-menu").innerHTML="<li><a href='#'>Home</a></li><li><a href='#about'>About</a></li><li><a href='#contact'>Contact</a></li>";
						document.getElementById("main-disp").innerHTML="<p class='lead'>&nbsp;</p><h1 class='cover-heading'><img src='"+data.profile_image_url.replace('normal', 'bigger')+"' alt='"+data.screen_name+"'></h1><p class='lead'>["+data.name+"] - @"+data.screen_name+"</p><p id='status' class='lead'>\""+processTweetLinks(data.status.text)+"\"</p><p class='lead'>from "+source+"</p><p class='lead'><button class='btn btn-default' type='button' focus onclick='window.location.replace(\"load-index.html\");'>Login as @"+data.screen_name+"</button><p class='lead'>&nbsp;</p>";
					});
				} else {
					document.getElementById("main-disp").innerHTML="<p class='lead'>&nbsp;</p><h1 class='cover-heading'>OAuth PIN</h1><p class='lead'><input  style='color:black;' id='pin' type='number' placeholder='PIN'></p><p class='lead'><button class='btn btn-default' id='pinbutton' type='button' onclick='auth();'>Submit</button></p><p class='lead'>&nbsp;</p>";
					$('#pin').keypress(function(e) {
						if(e.which == 13) {
							auth();
						}
					});
				}
			} else {
				document.getElementById("nav-menu").innerHTML="<li class='active'><a href='#'>Home</a></li><li><a href='#about'>About</a></li><li><a href='#contact'>Contact</a></li>";
				document.getElementById("main-disp").innerHTML="<p class='lead'>&nbsp;</p><h1 class='cover-heading'>Login</h1><p class='lead'><input style='color:black' type='text' id='login-username' placeholder='Username' required></p><p class='lead'><button id='login-button' onclick='doLogin();' class='btn btn-default' type='button' focus>Send</button></p><p class='lead'>&nbsp;</p>";
				$('#login-username').keypress(function(e) {
					if(e.which == 13) {
						doLogin();
					}
				});
			}
		}
		
		// Handles page display.
		// Initial Load.
		$(document).ready(function() { loadContent(location.hash); });
		$(window).on('hashchange', function () {
			loadContent(location.hash);
		});
		
		$(document).ready(function() {
			$("html").backstretch([
				"engine/public/img/bg.jpg",
				"engine/public/img/bg2.jpg",
				"engine/public/img/bg3.jpg",
				"engine/public/img/bg4.jpg"
			], {duration: 7500, fade: 900});
		});
	</script>
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">vTweet</h3>
              <ul id="nav-menu" class="nav masthead-nav">
              </ul>
            </div>
          </div>

          <div style="-webkit-border-top-left-radius: 15px;-webkit-border-bottom-left-radius: 15px; -webkit-border-top-right-radius: 15px;-webkit-border-bottom-right-radius: 15px;display:block; background: rgba(64, 64, 64, 0.8);" id='main-disp' class='inner cover'>
			<img src='engine/public/img/page_load.gif'>
		  </div>

          <div class="mastfoot">
            <div style="display:inline;-webkit-border-top-left-radius: 15px;-webkit-border-bottom-left-radius: 15px; -webkit-border-top-right-radius: 15px;-webkit-border-bottom-right-radius: 15px;background: rgba(64, 64, 64, 0.8);" class="inner">
              <p style='display:inline;-webkit-border-top-left-radius: 15px;-webkit-border-bottom-left-radius: 15px; -webkit-border-top-right-radius: 15px;-webkit-border-bottom-right-radius: 15px;background: rgba(64, 64, 64, 0.8);'>vTweet, by <a href="https://twitter.com/rdashinc" target='_blank'>@rdashinc</a>.</p>
            </div>
          </div>

        </div>

      </div>

    </div>
	<script>
		function auth() {
			doLoadThing("pinbutton");
			console.log("[index.html] auth(): Started.");
			var options = {
				consumerKey: window.config.consumer_key,
				consumerSecret: window.config.consumer_secret
			};
			var requestParams = location.hash.replace('#', '');
			var oauth = OAuth(options);
			var pin = document.getElementById("pin").value;
			oauth.get('https://twitter.com/oauth/access_token?oauth_verifier='+pin+'&'+requestParams,

			function(data) {
				console.dir(data);
					
				// split the query string as needed						
				var accessParams = {};
				var qvars_tmp = data.text.split('&');
				for (var i = 0; i < qvars_tmp.length; i++) {
				var y = qvars_tmp[i].split('=');
					accessParams[y[0]] = decodeURIComponent(y[1]);
				}
				console.log("[index.html] auth(): Got Access Token---: "+accessParams.oauth_token);
				console.log("[index.html] auth(): Got Access Token Secret---: "+accessParams.oauth_token_secret);
				console.log("[index.html] auth(): Writing for this sessions config.");
				
				// Write too Config.
				writeTooConfig('{ access_token: "'+accessParams.oauth_token+'", access_token_secret: "'+accessParams.oauth_token_secret+'"}', "config.main.js");
				
				// Init Application.
				window.location.replace("load-index.html");
			},
			function(data) { alert('Failed too Log you in, Try again Later.'); console.dir("[getPin.html] (): Returned Fail: "+data); }
			);		
		}
	</script>
  </body>
</html>